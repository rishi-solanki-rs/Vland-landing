<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Vlands - The Land Co-investing Marketplace</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="header">
      <div class="logo">
        <img
          src="WhatsApp Image 2025-12-29 at 3.30.19 PM.jpeg"
          alt="Vlands logo"
        />
      </div>
      <nav class="nav-menu">
        <a href="#">Home</a>
        <a href="#">How It Works</a>
        <a href="#">Live Deals</a>
        <a href="#">Contact / FAQ</a>
      </nav>
      <button class="cta-button" onclick="scrollToWatchlistForm()">
        Join Watchlist
      </button>
    </header>

    <section class="hero-section">
      <div class="hero-background-scroll">
        <div class="scroll-image-track">
          <div class="scroll-image-item">
            <img
              src="public/pexels-jessica-bryant-592135-1370704.jpg"
              alt="Property"
            />
          </div>
          <div class="scroll-image-item">
            <img
              src="public/pexels-isabella-mendes-107313-1795507.jpg"
              alt="Property"
            />
          </div>
          <!-- Duplicate for seamless loop -->
          <div class="scroll-image-item">
            <img
              src="public/pexels-jessica-bryant-592135-1370704.jpg"
              alt="Property"
            />
          </div>
          <div class="scroll-image-item">
            <img
              src="public/pexels-isabella-mendes-107313-1795507.jpg"
              alt="Property"
            />
          </div>
        </div>
      </div>
      <div class="hero-content">
        <h1>
          The Land Co-investing Marketplace: Acquire true, documented UDS
          ownership and buy or sell with total ease in just 5 minutes.
        </h1>
        <p>
          Access growing, pre-vetted land assets typically reserved for
          institutions. We fractionalize ownership using legally backed UDS,
          making high-return land investment simple and secure.
        </p>
      </div>
    </section>

    <section class="plot-map-section">
      <div class="map-container">
        <div class="map-wrapper">
          <div class="plot-labels">
            <span class="label-available">
              <span class="color-box"></span>
              Available
            </span>
            <span class="label-hot">
              <span class="color-box"></span>
              Hot
            </span>
            <span class="label-sold">
              <span class="color-box"></span>
              Sold
            </span>
          </div>
          <canvas id="plot-canvas"></canvas>
          <div id="mobile-instructions" class="mobile-instructions">
            <p>
              üëÜ Drag to rotate ‚Ä¢ ü§è Pinch 2 fingers to zoom ‚Ä¢ üëÜ Tap to select
            </p>
          </div>
        </div>

        <div id="watchlist-form" class="conversion-panel">
          <h3>Get early access to Vlands app</h3>
          <div id="plot-micro-details">
            <p><strong>Location:</strong> Sector C</p>
            <p><strong>Total Area:</strong> 1 Acre</p>
            <p><strong>Est. Return:</strong> 15%</p>
            <p>stron</p>
          </div>
          <form id="watchlist-signup-form">
            <input
              type="text"
              name="fullName"
              placeholder="Full Name (Required)"
              required
            />
            <input
              type="email"
              name="email"
              placeholder="Email Address (Required)"
              required
            />
            <input
              type="tel"
              name="mobile"
              placeholder="Mobile Number (Optional)"
            />
            <button type="submit" class="submit-button">Send Me Updates</button>
          </form>
          <p class="privacy-note">
            We respect your privacy. We'll send monthly or weekly updates on
            deal launches and platform news.
          </p>

          <!-- Admin Export Button (Hidden by default, can be shown for admin) -->
          <button
            id="export-excel-btn"
            onclick="exportToExcel()"
            style="
              display: none;
              margin-top: 1rem;
              padding: 0.5rem 1rem;
              background: #4caf50;
              color: white;
              border: none;
              border-radius: 5px;
              cursor: pointer;
            "
          >
            üì• Export Users to Excel
          </button>
        </div>
      </div>
    </section>

    <section class="trust-section">
      <h2
        style="
          text-align: center;
          margin-bottom: 3rem;
          color: var(--color-charcoal-dark);
          font-size: clamp(2rem, 4vw, 3rem);
        "
      >
        Why Trust Vlands?
      </h2>
      <div class="trust-carousel-container">
        <div class="trust-carousel">
          <div class="trust-block">
            <div class="icon-wrapper">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                <path d="M9 12l2 2 4-4"></path>
              </svg>
            </div>
            <h4>Legal Certainty</h4>
            <p>
              100% Documented Ownership. Every share is secured by the official
              Estamp of UDS, providing true legal ownership and peace of mind.
            </p>
          </div>
          <div class="trust-block">
            <div class="icon-wrapper">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polygon
                  points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"
                ></polygon>
              </svg>
            </div>
            <h4>Speed & Efficiency</h4>
            <p>
              Transact in 5 Minutes. Our streamlined digital platform allows you
              to browse, commit, and secure your co-investment faster than ever
              before.
            </p>
          </div>
          <div class="trust-block">
            <div class="icon-wrapper">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
              </svg>
            </div>
            <h4>Vetted Assets</h4>
            <p>
              Prime Land, Zero Hassle. We handle the due diligence, finding
              high-potential, secure land deals ready for co-investment.
            </p>
          </div>
          <!-- Duplicate for infinite loop -->
          <div class="trust-block">
            <div class="icon-wrapper">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                <path d="M9 12l2 2 4-4"></path>
              </svg>
            </div>
            <h4>Legal Certainty</h4>
            <p>
              100% Documented Ownership. Every share is secured by the official
              Estamp of UDS, providing true legal ownership and peace of mind.
            </p>
          </div>
          <div class="trust-block">
            <div class="icon-wrapper">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polygon
                  points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"
                ></polygon>
              </svg>
            </div>
            <h4>Speed & Efficiency</h4>
            <p>
              Transact in 5 Minutes. Our streamlined digital platform allows you
              to browse, commit, and secure your co-investment faster than ever
              before.
            </p>
          </div>
          <div class="trust-block">
            <div class="icon-wrapper">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
              </svg>
            </div>
            <h4>Vetted Assets</h4>
            <p>
              Prime Land, Zero Hassle. We handle the due diligence, finding
              high-potential, secure land deals ready for co-investment.
            </p>
          </div>
          <!-- Additional duplicates for seamless loop -->
          <div class="trust-block">
            <div class="icon-wrapper">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                <path d="M9 12l2 2 4-4"></path>
              </svg>
            </div>
            <h4>Legal Certainty</h4>
            <p>
              100% Documented Ownership. Every share is secured by the official
              Estamp of UDS, providing true legal ownership and peace of mind.
            </p>
          </div>
          <div class="trust-block">
            <div class="icon-wrapper">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polygon
                  points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"
                ></polygon>
              </svg>
            </div>
            <h4>Speed & Efficiency</h4>
            <p>
              Transact in 5 Minutes. Our streamlined digital platform allows you
              to browse, commit, and secure your co-investment faster than ever
              before.
            </p>
          </div>
          <div class="trust-block">
            <div class="icon-wrapper">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
              </svg>
            </div>
            <h4>Vetted Assets</h4>
            <p>
              Prime Land, Zero Hassle. We handle the due diligence, finding
              high-potential, secure land deals ready for co-investment.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Advanced Modern Promotional Section -->
    <section class="promo-section">
      <div class="particles-container">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
      </div>

      <div class="promo-container">
        <div class="promo-content">
          <div class="promo-badge">
            <span class="badge-icon">‚ú®</span>
            <span class="badge-text">Limited Time Offer</span>
            <span class="badge-pulse"></span>
          </div>

          <h2 class="promo-title">
            <span class="title-line"
              >Join
              <span class="highlight watchlist-count" id="watchlist-count"
                >1</span
              >
              watchlist</span
            >
          </h2>

          <p class="promo-description">
            Get exclusive early access to premium land deals. Start your
            investment journey today with
            <span class="highlight-text">zero commitment</span> and maximum
            returns.
          </p>

          <div class="promo-stats">
            <div class="stat-item stat-investors">
              <div class="stat-icon">üë•</div>
              <div class="stat-number" data-target="0">0</div>
              <div class="stat-label">Active Investors</div>
              <div class="stat-trend">‚Üó +12% this month</div>
            </div>
            <div class="stat-item stat-plots hide-mobile">
              <div class="stat-icon">üèûÔ∏è</div>
              <div class="stat-number" data-target="0">0</div>
              <div class="stat-label">Plots Available</div>
              <div class="stat-trend">‚Üó New listings daily</div>
            </div>
            <div class="stat-item stat-returns hide-mobile">
              <div class="stat-icon">üìà</div>
              <div class="stat-number" data-target="0">0</div>
              <div class="stat-label">Avg. Return %</div>
              <div class="stat-trend">‚Üó Above market avg</div>
            </div>
          </div>

          <div class="promo-features">
            <div class="feature-tag">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              <span>No Hidden Fees</span>
            </div>
            <div class="feature-tag">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              <span>Instant Access</span>
            </div>
            <div class="feature-tag">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              <span>24/7 Support</span>
            </div>
          </div>

          <div class="promo-cta">
            <button
              class="promo-button primary"
              onclick="scrollToWatchlistForm()"
            >
              <span class="button-shine"></span>
              <span class="button-text">Get Started Free</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M5 12h14"></path>
                <path d="M12 5l7 7-7 7"></path>
              </svg>
            </button>
            <button class="promo-button secondary">
              <span class="button-text">Watch Demo</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
              </svg>
            </button>
          </div>
        </div>

        <div class="promo-visual">
          <div class="visual-container">
            <div class="floating-card card-1">
              <div class="card-glow"></div>
              <div class="card-content">
                <div class="card-icon">üìä</div>
                <div class="card-text">Real-time Analytics</div>
                <div class="card-subtext">Live updates</div>
              </div>
            </div>
            <div class="floating-card card-2">
              <div class="card-glow"></div>
              <div class="card-content">
                <div class="card-icon">üîí</div>
                <div class="card-text">100% Secure</div>
                <div class="card-subtext">Bank-level encryption</div>
              </div>
            </div>
            <div class="floating-card card-3">
              <div class="card-glow"></div>
              <div class="card-content">
                <div class="card-icon">‚ö°</div>
                <div class="card-text">Instant Access</div>
                <div class="card-subtext">5-minute setup</div>
              </div>
            </div>
            <div class="promo-gradient gradient-1"></div>
            <div class="promo-gradient gradient-2"></div>
            <div class="grid-pattern"></div>
          </div>
        </div>
      </div>
    </section>

    <footer class="footer">
      <div class="footer-content">
        <div class="footer-section footer-brand">
          <div class="footer-logo">Vlands</div>
          <p class="footer-tagline">
            The Land Co-investing Marketplace. Acquire true, documented UDS
            ownership with ease.
          </p>
          <div class="social-icons">
            <a href="#" class="social-icon" aria-label="LinkedIn">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"
                ></path>
                <rect x="2" y="9" width="4" height="12"></rect>
                <circle cx="4" cy="4" r="2"></circle>
              </svg>
            </a>
            <a href="#" class="social-icon" aria-label="Twitter">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"
                ></path>
              </svg>
            </a>
            <a href="#" class="social-icon" aria-label="Facebook">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"
                ></path>
              </svg>
            </a>
            <a href="#" class="social-icon" aria-label="Instagram">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                <path
                  d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"
                ></path>
                <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
              </svg>
            </a>
          </div>
        </div>

        <div class="footer-section footer-links-section">
          <h5>Quick Links</h5>
          <ul class="footer-links-list">
            <li><a href="#">Home</a></li>
            <li><a href="#">How It Works</a></li>
            <li><a href="#">Live Deals</a></li>
            <li><a href="#">Contact / FAQ</a></li>
          </ul>
        </div>

        <div class="footer-section footer-legal">
          <h5>Legal</h5>
          <ul class="footer-links-list">
            <li><a href="#">Terms of Service</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">Legal Disclaimer</a></li>
            <li><a href="#">Compliance</a></li>
          </ul>
        </div>

        <div class="footer-section footer-newsletter">
          <h5>Stay Updated</h5>
          <p>
            Get the latest deals and platform updates delivered to your inbox.
          </p>
          <form
            class="newsletter-signup"
            onsubmit="event.preventDefault(); alert('Thank you for subscribing!');"
          >
            <input type="email" placeholder="Enter your email" required />
            <button type="submit" class="newsletter-button">Subscribe</button>
          </form>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2025 Vlands. All rights reserved.</p>
        <p class="footer-built">Built with ‚ù§Ô∏è for smart investors</p>
      </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollToPlugin.min.js"></script>

    <script src="threejs-map.js"></script>
    <script src="gsap-animations.js"></script>
    <script>
      // Set API base dynamically: prefer current origin when served, otherwise localhost fallback
      let API_BASE = "";
      try {
        if (window && window.location && window.location.protocol && window.location.protocol.startsWith("http")) {
          API_BASE = window.location.origin;
        } else {
          API_BASE = "http://localhost:3000";
        }
      } catch (e) {
        API_BASE = "http://localhost:3000";
      }
      console.log("API_BASE ->", API_BASE);

      // Scroll to watchlist form function
      function scrollToWatchlistForm() {
        const formElement = document.getElementById("watchlist-form");
        if (formElement) {
          // Calculate offset to account for fixed header
          const headerOffset = 80;
          const elementPosition = formElement.getBoundingClientRect().top;
          const offsetPosition =
            elementPosition + window.pageYOffset - headerOffset;

          // Smooth scroll
          window.scrollTo({
            top: offsetPosition,
            behavior: "smooth",
          });

          // Optional: Focus on first input after scroll
          setTimeout(() => {
            const firstInput = formElement.querySelector('input[type="text"]');
            if (firstInput) {
              firstInput.focus();
            }
          }, 500);
        }
      }

      // Counter Animation
      function animateCounter(element, target, duration = 2000) {
        let start = 0;
        const increment = target / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= target) {
            element.textContent = target.toLocaleString();
            clearInterval(timer);
          } else {
            element.textContent = Math.floor(start).toLocaleString();
          }
        }, 16);
      }

      // Intersection Observer for counter animation
      const observerOptions = {
        threshold: 0.5,
        rootMargin: "0px",
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const statNumbers = entry.target.querySelectorAll(".stat-number");
            statNumbers.forEach((stat) => {
              const target = parseInt(stat.getAttribute("data-target"));
              if (!stat.classList.contains("animated")) {
                stat.classList.add("animated");
                animateCounter(stat, target);
              }
            });
          }
        });
      }, observerOptions);

      // Get current watchlist count from localStorage or API
      function getWatchlistCount() {
        // Try to get from localStorage first (for demo)
        const stored = localStorage.getItem("watchlistCount");
        if (stored) {
          return parseInt(stored);
        }

        // Default starting count - start from 1
        return 1;
      }

      // Save watchlist count to localStorage or API
      function saveWatchlistCount(count) {
        // Save to localStorage (for demo)
        localStorage.setItem("watchlistCount", count.toString());

        // TODO: Also save to your API if needed
        // Example:
        // fetch('https://your-api.com/api/watchlist/count', {
        //     method: 'POST',
        //     headers: { 'Content-Type': 'application/json' },
        //     body: JSON.stringify({ count: count })
        // });
      }

      // Store user data in localStorage
      function saveUserData(userData) {
        // Get existing users from localStorage
        const existingUsers = JSON.parse(
          localStorage.getItem("watchlistUsers") || "[]"
        );

        // Add new user with timestamp
        const newUser = {
          ...userData,
          timestamp: new Date().toISOString(),
          date: new Date().toLocaleDateString("en-IN"),
          time: new Date().toLocaleTimeString("en-IN"),
        };

        existingUsers.push(newUser);

        // Save back to localStorage
        localStorage.setItem("watchlistUsers", JSON.stringify(existingUsers));

        console.log("User data saved:", newUser);
        console.log("Total users:", existingUsers.length);

        return existingUsers;
      }

      // Export all user data to Excel (CSV format)
      function exportToExcel() {
        const users = JSON.parse(
          localStorage.getItem("watchlistUsers") || "[]"
        );

        if (users.length === 0) {
          alert("No user data found to export.");
          return;
        }

        // Create CSV headers
        const headers = [
          "S.No",
          "Full Name",
          "Email",
          "Mobile",
          "Date",
          "Time",
          "Timestamp",
        ];

        // Create CSV rows
        const rows = users.map((user, index) => [
          index + 1,
          user.fullName || "",
          user.email || "",
          user.mobile || "",
          user.date || "",
          user.time || "",
          user.timestamp || "",
        ]);

        // Combine headers and rows
        const csvContent = [
          headers.join(","),
          ...rows.map((row) => row.map((cell) => `"${cell}"`).join(",")),
        ].join("\n");

        // Add BOM for Excel UTF-8 support
        const BOM = "\uFEFF";
        const blob = new Blob([BOM + csvContent], {
          type: "text/csv;charset=utf-8;",
        });

        // Create download link
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        link.setAttribute("href", url);
        link.setAttribute(
          "download",
          `watchlist_users_${new Date().toISOString().split("T")[0]}.csv`
        );
        link.style.visibility = "hidden";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        alert(`Exported ${users.length} user(s) to Excel file!`);
      }

      // Increment watchlist count when someone signs up
      function incrementWatchlistCount() {
        const watchlistElement = document.getElementById("watchlist-count");
        if (!watchlistElement) {
          console.error("Watchlist count element not found!");
          return;
        }

        // Get current count from element or localStorage
        let currentCount =
          parseInt(watchlistElement.textContent.replace(/,/g, "")) || 0;

        // If element shows 0 or invalid, get from localStorage
        if (currentCount === 0 || isNaN(currentCount)) {
          currentCount = getWatchlistCount();
        }

        const newCount = currentCount + 1;

        console.log("Incrementing count:", currentCount, "->", newCount);

        // Update immediately (don't wait for animation)
        watchlistElement.textContent = newCount.toLocaleString();

        // Animate the increment for visual effect
        animateCounter(watchlistElement, newCount, 800);

        // Also increment the visible 'Active Investors' stat for immediate feedback
        incrementStatNumber(".stat-item.stat-investors .stat-number", 1, 800);

        // Save the new count
        saveWatchlistCount(newCount);
      }

      // Fetch and update watchlist count
      async function updateWatchlistCount() {
        const watchlistElement = document.getElementById("watchlist-count");
        if (!watchlistElement) return;

        try {
          // Try to get authoritative count from backend
          const data = await fetchBackendData();
          if (data && typeof data.watchlistCount !== 'undefined') {
            const count = Number(data.watchlistCount) || 0;
            const currentCount = parseInt(watchlistElement.textContent.replace(/,/g, "")) || 0;
            if (currentCount === 0) {
              watchlistElement.textContent = count.toLocaleString();
            } else {
              animateCounter(watchlistElement, count, 800);
            }
            // persist locally
            saveWatchlistCount(count);
            return;
          }

          // Fallback to localStorage/default if backend unavailable
          const fallback = getWatchlistCount();
          watchlistElement.textContent = fallback.toLocaleString();
        } catch (error) {
          console.error("Error fetching watchlist count:", error);
          // Fallback to default count
          const fallbackCount = getWatchlistCount();
          watchlistElement.textContent = fallbackCount.toLocaleString();
        }
      }

      // --- Backend integration ---
      async function fetchBackendData() {
        try {
          console.log("CALLING API...");
          const res = await fetch(`${API_BASE}/api/landing/stats`, {
            method: "GET",
            headers: { "Content-Type": "application/json" },
            cache: "no-store",
          });

          const data = await res.json();
          console.log("API RESPONSE:", data);
          return data;
        } catch (err) {
          console.error("API FAILED:", err);
          return null;
        }
      }

     function applyBackendData(data) {
      if (!data) return;

      const inv = document.querySelector(".stat-item.stat-investors .stat-number");
      const plots = document.querySelector(".stat-item.stat-plots .stat-number");
      const ret = document.querySelector(".stat-item.stat-returns .stat-number");

      if (inv) {
        const target = Number(data.stats.activeInvestors) || 0;
        inv.setAttribute("data-target", target);
        // start from 0 and animate to target
        inv.textContent = "0";
        animateCounter(inv, target, 1000);
      }

      if (plots) {
        const target = Number(data.stats.plotsAvailable) || 0;
        plots.setAttribute("data-target", target);
        plots.textContent = "0";
        animateCounter(plots, target, 1000);
      }

      if (ret) {
        const target = Math.round(Number(data.stats.avgReturnPercent) || 0);
        ret.setAttribute("data-target", target);
        ret.textContent = "0";
        animateCounter(ret, target, 1000);
      }

      // Update watchlist count display (prefer backend-provided value)
      try {
        const watchEl = document.getElementById("watchlist-count");
        if (watchEl) {
          const backendCount = Number(data.watchlistCount || 0);
          if (!isNaN(backendCount)) {
            watchEl.textContent = backendCount.toLocaleString();
            animateCounter(watchEl, backendCount, 800);
            // persist locally for fallback
            saveWatchlistCount(backendCount);
          }
        }
      } catch (e) {
        console.warn('Failed to update watchlist count from backend data', e);
      }
}


    // Increment a stat-number element by a given amount (and animate)
    function incrementStatNumber(selector, amount = 1, duration = 800) {
      const el = document.querySelector(selector);
      if (!el) return;

      const current = parseInt(el.textContent.replace(/,/g, "")) || 0;
      const target = current + amount;
      el.textContent = target.toLocaleString();
      // Ensure data-target is updated for consistency
      el.setAttribute("data-target", target);
      // Animate from current to target for a smooth visual
      animateCounter(el, target, duration);
    }

      // Observe promo section when DOM is ready
      document.addEventListener("DOMContentLoaded", () => {
        // Load dynamic data from backend (if available) and apply to page
        fetchBackendData().then(data => applyBackendData(data));
        const promoSection = document.querySelector(".promo-section");
        if (promoSection) {
          observer.observe(promoSection);
        }

        // Update watchlist count on page load
        updateWatchlistCount();

        // Show export button functionality (for admin)
        const exportBtn = document.getElementById("export-excel-btn");
        if (exportBtn) {
          // Check if there are users to export
          const users = JSON.parse(
            localStorage.getItem("watchlistUsers") || "[]"
          );
          if (users.length > 0) {
            // Show button if users exist (you can always show it by uncommenting next line)
            // exportBtn.style.display = 'block';

            // Admin shortcut: Press Ctrl+Shift+E to show/hide export button
            document.addEventListener("keydown", function (e) {
              if (e.ctrlKey && e.shiftKey && e.key === "E") {
                e.preventDefault();
                exportBtn.style.display =
                  exportBtn.style.display === "none" ? "block" : "none";
                alert("Export button toggled!");
              }
            });
          }
        }

        // Make exportToExcel available globally for console access
        window.exportToExcel = exportToExcel;

        // Handle watchlist form submission - INTEGRATION POINT
        const watchlistForm = document.getElementById("watchlist-signup-form");
        if (watchlistForm) {
          watchlistForm.addEventListener("submit", async function (e) {
            e.preventDefault();

            // Get form data
            const formData = new FormData(watchlistForm);
            const fullName = formData.get("fullName");
            const email = formData.get("email");
            const mobile = formData.get("mobile");

            // Show loading state
            const submitButton = watchlistForm.querySelector(".submit-button");
            const originalButtonText = submitButton.textContent;
            submitButton.textContent = "Submitting...";
            submitButton.disabled = true;

              try {
                console.log('Calling signup API:', `${API_BASE}/api/watchlist/signup`);
                const resp = await fetch(`${API_BASE}/api/watchlist/signup`, {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ fullName, email, mobile }),
                });

                let result = {};
                try {
                  result = await resp.json();
                } catch (parseErr) {
                  console.warn('Could not parse JSON response', parseErr);
                }

                if (resp.ok) {
                  // Update watchlist count from server response if provided
                  if (result && result.watchlistCount != null) {
                    const watchEl = document.getElementById("watchlist-count");
                    if (watchEl)
                      watchEl.textContent = Number(
                        result.watchlistCount
                      ).toLocaleString();
                  }
                  // Refresh full stats from backend to update all stat counters
                  fetchBackendData().then((d) => applyBackendData(d));

                  alert(
                    "Thank you! You've been added to the watchlist. We'll send you updates soon."
                  );
                  watchlistForm.reset();
                } else {
                  console.error('Signup API returned error', resp.status, result);
                  // Fallback to local save
                  saveUserData({ fullName, email, mobile: mobile || "N/A" });
                  incrementWatchlistCount();
                  alert('Signed up locally (server error).');
                  watchlistForm.reset();
                }
              } catch (e) {
                console.warn('Watchlist signup failed, saving locally', e);
                saveUserData({ fullName, email, mobile: mobile || "N/A" });
                incrementWatchlistCount();
                alert("You're signed up locally (offline).");
                watchlistForm.reset();
            } finally {
              // Reset button state
              submitButton.textContent = originalButtonText;
              submitButton.disabled = false;
            }
          });
        }

        // Optionally update every 30 seconds for live updates
        // setInterval(updateWatchlistCount, 30000);

        // GSAP Animations - Slowly
        // Fallback: Make sure all content is visible even if GSAP doesn't load
        const allContent = document.querySelectorAll(
          ".hero-section h1, .hero-section p, .map-container, .plot-labels, .conversion-panel, .property-card, .trust-block, .promo-content"
        );
        allContent.forEach((el) => {
          if (el) el.style.opacity = "1";
        });

        if (
          typeof gsap !== "undefined" &&
          typeof ScrollTrigger !== "undefined"
        ) {
          gsap.registerPlugin(ScrollTrigger);

          // Set initial visibility for elements
          gsap.set(".hero-section h1, .hero-section p", { opacity: 1 });
          gsap.set(".map-container, .plot-labels, .conversion-panel", {
            opacity: 1,
          });
          gsap.set(".property-card", { opacity: 1 });

          // Hero Section - Slow fade in
          gsap.from(".hero-section h1", {
            opacity: 0,
            y: 30,
            duration: 1.5,
            ease: "power2.out",
            delay: 0.3,
          });

          gsap.from(".hero-section p", {
            opacity: 0,
            y: 20,
            duration: 1.2,
            ease: "power2.out",
            delay: 0.6,
          });

          // Header scroll animation
          const header = document.querySelector(".header");
          if (header) {
            ScrollTrigger.create({
              start: "top -50",
              end: 99999,
              toggleClass: { className: "scrolled", targets: header },
            });
          }

          // Plot Map Section - Slow animation
          // CRITICAL: Ensure elements are visible first and stay visible
          gsap.set(
            ".map-container, .map-wrapper, #plot-canvas, .plot-labels, .conversion-panel",
            {
              opacity: 1,
              visibility: "visible",
              display: "block",
            }
          );

          // Only animate if section comes into view, but ensure visibility
          const mapSectionEl = document.querySelector(".plot-map-section");
          if (mapSectionEl) {
            const rect = mapSectionEl.getBoundingClientRect();
            const isInView = rect.top < window.innerHeight * 0.85;

            if (isInView) {
              // Already in view - just ensure visible
              gsap.set(".map-container, .map-wrapper, #plot-canvas", {
                opacity: 1,
              });
            } else {
              // Animate when scrolling into view
              gsap.from(".map-container", {
                scrollTrigger: {
                  trigger: ".plot-map-section",
                  start: "top 85%",
                  toggleActions: "play none none none",
                  onEnter: () => {
                    gsap.set(".map-container, .map-wrapper, #plot-canvas", {
                      opacity: 1,
                    });
                  },
                },
                opacity: 0,
                y: 40,
                duration: 1.2,
                ease: "power2.out",
                immediateRender: false,
              });
            }
          }

          gsap.from(".plot-labels", {
            scrollTrigger: {
              trigger: ".plot-map-section",
              start: "top 85%",
              toggleActions: "play none none none",
            },
            opacity: 0,
            x: -20,
            duration: 1,
            delay: 0.4,
            ease: "power2.out",
          });

          gsap.from(".conversion-panel", {
            scrollTrigger: {
              trigger: ".plot-map-section",
              start: "top 85%",
              toggleActions: "play none none none",
            },
            opacity: 0,
            x: 20,
            duration: 1,
            delay: 0.6,
            ease: "power2.out",
          });

          // Trust Section - Carousel has its own CSS animation
          // Remove any GSAP interference to ensure carousel is visible
          // No GSAP animation needed for trust blocks

          // Promo Section - Slow animations
          gsap.from(".promo-content", {
            scrollTrigger: {
              trigger: ".promo-section",
              start: "top 85%",
              toggleActions: "play none none none",
            },
            opacity: 0,
            x: -50,
            duration: 1.5,
            ease: "power2.out",
          });

          gsap.from(".promo-visual", {
            scrollTrigger: {
              trigger: ".promo-section",
              start: "top 85%",
              toggleActions: "play none none none",
            },
            opacity: 0,
            x: 50,
            duration: 1.5,
            ease: "power2.out",
          });

          gsap.from(".floating-card", {
            scrollTrigger: {
              trigger: ".promo-visual",
              start: "top 85%",
              toggleActions: "play none none none",
            },
            opacity: 0,
            scale: 0.8,
            duration: 1,
            stagger: 0.2,
            ease: "power2.out",
          });

          // Stats - Slow animation
          gsap.from(".stat-item", {
            scrollTrigger: {
              trigger: ".promo-stats",
              start: "top 85%",
              toggleActions: "play none none none",
            },
            opacity: 0,
            y: 20,
            duration: 0.8,
            stagger: 0.15,
            ease: "power2.out",
          });

          // Footer - Slow fade (ensure visible by default)
          gsap.set(".footer-content", { opacity: 1, y: 0 });
          gsap.from(".footer-content", {
            scrollTrigger: {
              trigger: ".footer",
              start: "top 90%",
              toggleActions: "play none none none",
            },
            opacity: 0,
            y: 30,
            duration: 1.2,
            ease: "power2.out",
            immediateRender: false,
          });

          // Smooth hover animations
          document
            .querySelectorAll(".promo-button, .cta-button")
            .forEach((button) => {
              button.addEventListener("mouseenter", () => {
                gsap.to(button, {
                  scale: 1.03,
                  duration: 0.4,
                  ease: "power2.out",
                });
              });
              button.addEventListener("mouseleave", () => {
                gsap.to(button, {
                  scale: 1,
                  duration: 0.4,
                  ease: "power2.out",
                });
              });
            });
        }
      });
    </script>
  </body>
</html>
